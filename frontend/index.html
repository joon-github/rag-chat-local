<!-- frontend/index.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>RAG Chat</title>
  </head>
  <body>
    <h2>π“ RAG Chat</h2>
    <div>
      <h1>RAG ν΄λ” κ°μ‹ μ‹μ‘</h1>
      <button id="selectBtn">ν΄λ” μ„ νƒ λ° κ°μ‹</button>
      <p id="status"></p>
    </div>
    <div>
      <input
        type="text"
        id="question"
        placeholder="μ§λ¬Έ μ…λ ¥..."
        style="width: 400px"
      />
      <button onclick="ask()">μ§λ¬Έν•κΈ°</button>
      <pre id="response" style="white-space: pre-wrap"></pre>
    </div>

    <script>
      async function ask() {
        const q = document.getElementById("question").value;
        const res = await fetch(
          `http://localhost:8000/ask?q=${encodeURIComponent(q)}`
        );
        const reader = res.body.getReader();
        const decoder = new TextDecoder("utf-8");
        document.getElementById("response").innerText = "";

        while (true) {
          const { done, value } = await reader.read();
          if (done) break;
          const chunk = decoder.decode(value);
          document.getElementById("response").innerText += chunk;
        }
      }

      const selectBtn = document.getElementById("selectBtn");
      const status = document.getElementById("status");

      selectBtn.addEventListener("click", async () => {
        const folder = await window.electronAPI.selectFolder();
        console.log(folder);
        if (!folder) {
          status.textContent = "μ·¨μ†λ¨";
          return;
        }

        status.textContent = `π“‚ κ°μ‹ μ¤‘: ${folder}`;

        // λ°±μ—”λ“λ΅ watch μ”μ²­
        fetch("http://localhost:8000/watch", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ folder_path: folder }),
        })
          .then((res) => res.json())
          .then((data) => {
            console.log("κ°μ‹ μ‹μ‘ μ‘λ‹µ:", data);
          })
          .catch((err) => {
            console.error("κ°μ‹ μ‹¤ν¨:", err);
            status.textContent = "β κ°μ‹ μ‹¤ν¨";
          });
      });
    </script>
  </body>
</html>
